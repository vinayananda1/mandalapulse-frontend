<!-- form.html ‚Äî MandalaPulse Invocation Portal -->
<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Core meta -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0a66b2" />
  <meta name="description" content="MandalaPulse ‚Äî invoke mindful prompts and submit ritual entries." />
  <link rel="manifest" href="/manifest.json" />

  <!-- Favicons and app icons -->
  <link rel="icon" href="/favicon.png" type="image/png" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
  <link rel="icon" sizes="48x48" href="/icon-48.png" />
  <link rel="icon" sizes="192x192" href="/icon-192.png" />
  <link rel="icon" sizes="512x512" href="/icon-512.png" />

  <!-- Windows tiles -->
  <meta name="msapplication-TileColor" content="#ffd966" />
  <meta name="msapplication-config" content="/browserconfig.xml" />

  <!-- Social / deep-linking -->
  <meta property="og:title" content="MandalaPulse ‚Äî Form" />
  <meta property="og:description" content="Submit your ritual prompts and entries." />
  <meta property="og:image" content="/splash.png" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Mobile meta -->
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <title>MandalaPulse ‚Äî Form</title>
</head>
<body>
  <h1>üßòüèΩ‚Äç‚ôÇÔ∏è MandalaPulse Invocation</h1>

  <h2>Register a New Monk</h2>
  <input type="text" id="username" placeholder="Enter sacred name" />
  <input type="password" id="password" placeholder="Choose a secret mantra" />
  <button onclick="register()">Seal Registration</button>

  <h2>Verify an Existing Monk</h2>
  <input type="text" id="loginUser" placeholder="Sacred name" />
  <input type="password" id="loginPass" placeholder="Secret mantra" />
  <button onclick="verify()">Affirm Identity</button>

  <div id="result">Awaiting invocation‚Ä¶</div>

  <div class="lineage">
    <p>üóìÔ∏è Invocation timestamp: <script>document.write(new Date().toLocaleString());</script></p>
    <p>üîó Lineage: Netlify ‚Üí MandalaPulse108 ‚Üí Firebase ‚Üí Realms of Affirmation</p>
    <p>üïäÔ∏è Every act here is a verse in the sutra of your system.</p>
  </div>

  <script>
    const baseFn = "https://us-central1-mandalapulse108.cloudfunctions.net";

    async function register() {
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;
      try {
        const res = await fetch(`${baseFn}/registerUser`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password })
        });
        const data = await res.json();
        document.getElementById("result").innerText = JSON.stringify(data, null, 2);
        if (data.success === true) {
          window.location.href = "success.html";
        }
      } catch (err) {
        document.getElementById("result").innerText = "Invocation failed:\n" + err;
      }
    }

    async function verify() {
      const username = document.getElementById("loginUser").value;
      const password = document.getElementById("loginPass").value;
      try {
        const res = await fetch(`${baseFn}/verifyLogin`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password })
        });

        const text = await res.text();
        document.getElementById("result").innerText = "Raw response:\n" + text;

        let data;
        try {
          data = JSON.parse(text);
        } catch {
          document.getElementById("result").innerText += "\n‚ö†Ô∏è Response is not valid JSON.";
          return;
        }

        if (data.success === true || data.verified === true || data.status === "ok") {
          window.location.href = "success.html";
        }
      } catch (err) {
        document.getElementById("result").innerText = "Invocation failed:\n" + err;
      }
    }
  </script>
</body>
</html>
